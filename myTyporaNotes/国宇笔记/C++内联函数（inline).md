### C++内联函数（inline)

 	inline是C++语言中的一个关键字，可以用于程序中定义内联函数，inline的引进使内联函数的定义更加简单。说到内联函数，这里给出比较常见的定义，内联函数是C++中的一种特殊函数，它可以像普通函数一样被调用，但是在调用时并不通过函数调用的机制而是通过将函数体直接插入调用处来实现的，这样可以大大减少由函数调用带来的开销，从而提高程序的运行效率。一般来说inline用于定义类的成员函数。 

 一般来说，inline适用的函数有两种，一种是在类内定义的成员函数，另一种是在类内声明，类外定义的成员函数，对于这两种情况inline的使用有一些不同：

1. 类内定义成员函数

 这种情况下，我们可以不用在函数头部加inline关键字，因为编译器会自动将类内定义的函数声明为内联函数，代码如下：

```c++
class temp{
  public:
     int  amount;

  //构造函数
   temp(int amount){
      this->amount = amount;
   }

  //普通成员函数，在类内定义时前面可以不加inline
  void print_amount(){
    cout << this-> amount;
  }
}
```

​	从上面的代码可以看出，在类内定义函数时，可以不加inline关键字，编译器会自动将类内定义的函数（构造函数、析构函数、普通成员函数等）设置为内联，具有内联函数调用的性质。 

2. 类内声明函数，在类外定义函数

​	根据C++编译器的规则，这种情况下如果想将该函数设置为内联函数，则可以在类内声明时不加inline关键字，而在类外定义函数时加上inline关键字，代码如下所示：

```c++
class temp{
  public:
     int  amount;

  //构造函数
   temp(int amount){
      this->amount = amount;
   }

  //普通成员函数，在类内声明时前面可以不加inline
  void print_amount()
}

//在类外定义函数体，必须在前面加上inline关键字
inline void temp:: print_amount(){
  cout << amount << endl;
}
```

​	从上面代码我们可以看出，类内声明可以不用加上inline关键字，但是类外定义函数体时必须要加上，这样才能保证编译器能够识别其为内联函数。

  另外，我们可以在声明函数和定义函数的同时写inline，也可以只在函数声明时加inline，而定义函数时不加inline。只要在调用该函数之前把inline的信息告知编译系统，编译系统就会在处理函数调用时按内联函数处理。也就是说，上面说的几种方法都可以实现一个内联函数的定义，根据自己的需要来写即可。

#### 优点：

- inline 定义的类的内联函数，函数的代码被放入符号表中，在使用时直接进行替换，（像宏一样展开），没有了调用的开销，效率也很高。
- 很明显，类的内联函数也是一个真正的函数，编译器在调用一个内联函数时，会首先检查它的参数的类型，保证调用正确。然后进行一系列的相关检查，就像对待任何一个真正的函数一样。这样就消除了它的隐患和局限性。（宏替换不会检查参数类型，安全隐患较大）
- inline函数可以作为一个类的成员函数，与类的普通成员函数作用相同，可以访问一个类的私有成员和保护成员。内联函数可以用于替代一般的宏定义，最重要的应用在于类的存取函数的定义上面。

####  缺点：

- 内联函数具有一定的局限性，内联函数的函数体一般来说不能太大，如果内联函数的函数体过大，一般的编译器会放弃内联方式，而采用普通的方式调用函数。(换句话说就是，你使用内联函数，只不过是向编译器提出一个申请，编译器可以拒绝你的申请）这样，内联函数就和普通函数执行效率一样了。
- inline说明对编译器来说只是一种建议，编译器可以选择忽略这个建议。比如，你将一个长达1000多行的函数指定为inline，编译器就会忽略这个inline，将这个函数还原成普通函数，因此并不是说把一个函数定义为inline函数就一定会被编译器识别为内联函数，具体取决于编译器的实现和函数体的大小。

#### 内联函数和宏定义的区别

​    内联函数和宏的区别在于，宏是由预处理器对宏进行替代，而内联函数是通过编译器控制来实现的。而且内联函数是真正的函数，只是在需要用到的时候，内联函数像宏一样的展开，所以取消了函数的参数压栈，减少了调用的开销。你可以像调用函数一样来调用内联函数，而不必担心会产生于处理宏的一些问题。内联函数与带参数的宏定义进行下比较，它们的代码效率是一样，但是内联欢函数要优于宏定义，因为内联函数遵循的类型和作用域规则，它与一般函数更相近，在一些编译器中，一旦关联上内联扩展，将与一般函数一样进行调用，比较方便。 

​    另外，宏定义在使用时只是简单的文本替换，并没有做严格的参数检查，也就不能享受C++编译器严格类型检查的好处，另外它的返回值也不能被强制转换为可转换的合适的类型，这样，它的使用就存在着一系列的隐患和局限性。

​    C++的inline的提出就是为了完全取代宏定义，因为inline函数取消了宏定义的缺点，又很好地继承了宏定义的优点，《Effective C++》中就提到了尽量使用Inline替代宏定义的条款，足以说明inline的作用之大。

### 使用注意事项

- 内联函数不能包括复杂的控制语句，如循环语句和switch语句；
- 只将规模很小（一般5个语句一下）而使用频繁的函数 声明为内联函数。在函数规模很小的情况下，函数调用的时间开销可能相当于甚至超过执行函数本身的时间，把它定义为内联函数，可大大减少程序运行时间。